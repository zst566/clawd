# 茂名交投文旅平台 - 项目记录

> 本文件用于记录茂名文旅平台的群讨论、开发进度、待办事项等

---

## ⚠️ 重要规则：开发环境访问规范

**首要规则**：所有测试环境的访问都必须通过 **Nginx 反向代理**，禁止直接访问前端或后端容器。

### ❌ 错误做法（禁止）
- 直接访问 `http://localhost:1313` (mobile-h5)
- 直接访问 `http://localhost:1212` (pc-admin)
- 直接访问 `http://localhost:3002` (backend)

### ✅ 正确做法（必须）
| 页面 | 正确访问地址 |
|------|-------------|
| 移动端H5 | `http://localhost` |
| PC管理端 | `http://localhost/pc-admin/` |
| 后端API | `http://localhost/api/mobile/*` |
| 健康检查 | `http://localhost/health` |

### 架构说明
```
用户访问 (80端口)
    │
    ▼
┌─────────────────────────────────────┐
│  Nginx 反向代理                      │
│  - / → mobile-h5 (容器5173端口)      │
│  - /pc-admin/* → pc-admin           │
│  - /api/* → backend                 │
└─────────────────────────────────────┘
```

### 为何有此规则
1. **真实模拟生产环境** - Nginx处理所有路由、静态文件、CORS
2. **避免端口冲突** - 各服务独立容器，无需暴露多个端口
3. **统一入口管理** - 便于日志、监控、权限控制
4. **调试更准确** - 发现的问题更接近生产环境

---

## 📊 项目信息

**项目名称**: 茂名交投文旅平台
**项目路径**: `/Volumes/SanDisk2T/dv-codeBase/茂名·交投-文旅平台/`
**包含模块**:
- PC管理后台 (`apps/pc-admin`) - Vue3 + Element Plus
- 后端API (`apps/backend`) - Node.js + Prisma + MySQL
- 小程序端 (`apps/miniprogram`)
- 移动端H5 (`apps/mobile-h5`)

---

## 📝 讨论事项记录

### 2026-02-02

- [x] **代码Review任务** ✅ 完成
  - 负责人: 小d
  - 状态: 子任务完成
  - 发现问题: 高风险13个 | 中等12个 | 低风险6个
  - 子任务ID: d268a406-27a3-4044-a372-01e5cbcfb978

- [x] **高风险问题修复** ✅ 完成
  - 负责人: 小d
  - 状态: 所有高风险问题已修复并重启服务
  - 修复数量: 9个 (后端5个 + 前端4个)

---

## ✅ 已完成事项

### 2026-01-29
- ✅ 民宿管理页面 - 修复前端字段名与后端返回不一致问题
  - coverImage → cover_image
  - roomCount → rooms?.length
  - sort → sort_order

---

## ⏳ 待办任务

| 优先级 | 任务 | 备注 |
|--------|------|------|
| 中 | 代码Review报告 | 等待子任务完成 |
| - | - | - |

---

## 🚨 高风险问题修复计划

| 序号 | 问题 | 位置 | 修复状态 | 子任务ID |
|------|------|------|----------|----------|
| 1 | 密码验证逻辑不安全 | backend/routes/mobile/index.js | 🔄 修复中 | b554ede3-af8a-4a13-85b6-a8496127436d |
| 2 | JWT密钥风险检查 | backend/src/middleware/auth.js | 🔄 修复中 | b554ede3-af8a-4a13-85b6-a8496127436d |
| 3 | 验证码存储内存泄漏 | backend/routes/pc/index.js | 🔄 修复中 | b554ede3-af8a-4a13-85b6-a8496127436d |
| 4 | 缺少请求大小限制 | backend/src/index.js | 🔄 修复中 | b554ede3-af8a-4a13-85b6-a8496127436d |
| 5 | 敏感信息泄露 | backend/routes/mobile/index.js | ✅ 已修复 | b554ede3-af8a-4a13-85b6-a8496127436d |
| 6 | XSS漏洞 | pc-admin/views/attractions/Index.vue | ✅ 已修复 | af31aab2-61bc-4524-b6f9-0113a4ea4e28 |
| 7 | 敏感数据localStorage存储 | pc-admin/src/api/auth.js | ✅ 已修复 | af31aab2-61bc-4524-b6f9-0113a4ea4e28 |
| 8 | 缺少CSRF保护 | pc-admin | ✅ 已修复 | af31aab2-61bc-4524-b6f9-0113a4ea4e28 |
| 9 | 登录态URL参数不安全 | miniprogram | ✅ 已修复 | af31aab2-61bc-4524-b6f9-0113a4ea4e28 |

---

## 📈 开发进度追踪

**当前阶段**: 代码Review中
**下一步**: 待Review完成后确定优化方向

---

## 💡 想法/建议

（记录一些好的想法但尚未实施）

---

## 📎 附件/链接

- 项目文档: 见 `/Volumes/SanDisk2T/dv-codeBase/茂名·交投-文旅平台/docs/`
- 相关脚本: -

---

*本文件由小d自动维护，最后更新: 2026-02-02*
