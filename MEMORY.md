# MEMORY.md - 长期记忆

## 项目目录

### 茂名交投文旅平台 (别名: 文旅)
- **路径**: `/Volumes/SanDisk2T/dv-codeBase/茂名·交投-文旅平台/`
- **描述**: 包含PC管理后台、后端API、小程序端、移动端H5
- **别名关键词**: 茂名、文旅、maoming
- **子目录**:
  - `apps/pc-admin` - PC端管理后台 (Vue3 + Element Plus)
  - `apps/backend` - 后端API (Node.js + Prisma + MySQL)
  - `apps/miniprogram` - 小程序端
  - `apps/mobile-h5` - 移动端H5
- **技术栈**: Vue3, Element Plus, Node.js, Prisma, MySQL

---

### 润德教育 - 收入摊销系统 (别名: 润德、RunDeEdu)
- **路径**: `/Volumes/SanDisk2T/dv-codeBase/RunDeEdu/`
- **描述**: 收入摊销数据核对、财务报表分析系统
- **别名关键词**: 润德、RunDeEdu、润德教育
- **主要目录**:
  - `src/` - 核心源代码 (1.3G)
  - `revenue-recognition-management/` - 收入摊销管理模块 (660M)
  - `docs/` - 文档目录 (350M)
  - `scripts/` - 自动化脚本
  - `tests/` - 测试文件
  - `db/` - 数据库相关
- **主要脚本**:
  - `batch_order_chain_query.py` - 批量订单链查询
  - `extract_full_order_chain.py` - 提取完整订单链
  - `order_comparison_statistics.py` - 订单对比统计
  - `update_course_scheduling.py` - 更新课程安排
- **用途**: 财务数据核对、收入摊销计算、订单链分析

---

## 🔀 项目切换规则

> **重要**：为了避免项目之间搞混，请遵守以下规则

### 规则1：说话带项目前缀
| 格式 | 例子 |
|------|------|
| `[文旅]` | `[文旅] 帮我看看景点管理页面` |
| `[润德]` | `[润德] 运行一下12月财务核对脚本` |

### 规则2：没说项目 → 我会确认
- 如果你没有带项目前缀，我会问清楚再执行
- 确认方式："你说的xx是茂名文旅还是润德教育？"

### 规则3：当前进行中项目
- 每次会话开始，我会记录"当前进行中的项目"到 TASKS.md
- 默认延续上一个项目，但每次说话最好带上前缀

---

## 🚨 警告
> **禁止自动推断**：在没有明确项目信息的情况下，我**不能**自己猜是哪个项目，必须先确认！

### 茂名交投文旅平台 (别名: 文旅)
- **路径**: `/Volumes/SanDisk2T/dv-codeBase/茂名·交投-文旅平台/`
- **描述**: 包含PC管理后台、后端API、小程序端、移动端H5
- **别名关键词**: 茂名、文旅、maoming
- **子目录**:
  - `apps/pc-admin` - PC端管理后台 (Vue3 + Element Plus)
  - `apps/backend` - 后端API (Node.js + Prisma + MySQL)
  - `apps/miniprogram` - 小程序端
  - `apps/mobile-h5` - 移动端H5
- **技术栈**: Vue3, Element Plus, Node.js, Prisma, MySQL

---

### 润德教育 - 收入摊销系统 (别名: 润德、RunDeEdu)
- **路径**: `/Volumes/SanDisk2T/dv-codeBase/RunDeEdu/`
- **描述**: 收入摊销数据核对、财务报表分析系统
- **别名关键词**: 润德、RunDeEdu、润德教育
- **主要目录**:
  - `src/` - 核心源代码 (1.3G)
  - `revenue-recognition-management/` - 收入摊销管理模块 (660M)
  - `docs/` - 文档目录 (350M)
  - `scripts/` - 自动化脚本
  - `tests/` - 测试文件
  - `db/` - 数据库相关
- **主要脚本**:
  - `batch_order_chain_query.py` - 批量订单链查询
  - `extract_full_order_chain.py` - 提取完整订单链
  - `order_comparison_statistics.py` - 订单对比统计
  - `update_course_scheduling.py` - 更新课程安排
- **用途**: 财务数据核对、收入摊销计算、订单链分析

## 数据库

### 茂名文旅平台数据库
- **地址**: 172.16.100.50
- **端口**: 3306
- **数据库**: wanda_platform
- **用户**: root
- **密码**: Awrt_2024

### 管理员账号
- **账号**: 13800000000
- **密码**: 123456
- **角色**: admin

## API端点

| 模块 | 端点 |
|------|------|
| 民宿 | `/api/pc/homestays` |
| 景点 | `/api/pc/attractions` |
| 资讯 | `/api/pc/articles` |

## 开发任务

### 2026-01-29
- [x] 民宿管理页面 - 修复前端字段名与后端返回不一致问题
  - coverImage → cover_image
  - roomCount → rooms?.length
  - sort → sort_order

---

## 🏠 家居设备维护记录

### 保险箱电池
- **更换日期**: 2026年1月31日
- **预计有效时间**: 约4个月
- **提醒时间**: 2026年5月15日左右开始提醒
- **确认更换后**: 记录新更换日期，重新计算4个月周期

---

## 💼 客户/项目记录（已放弃）

### 金蝶梁小姐小程序项目
- **时间**: 2026年1月31日
- **状态**: ❌ 已放弃
- **原因**: 客户预算太低，不值得投入
- **备注**: 后续如客户提高预算，可重新评估

---

## 2026年1月31日 - 润德教育财务数据核对

### 完成的工作

1. **12月三方平台流水核对**
   - 文件: `202512微信支付宝流水_核对结果.csv`
   - 数据量: 79,631行
   - 结果: 43,956条存在, 4条不存在, 35,671条为空

2. **11月三方平台流水核对**
   - 总订单编码: 57,751条 (去重后28,967)
   - 在sale_income_log中找到: 28,964
   - 未找到: 3条

3. **润德教育3.0数据清理** - ✅ 已修复
   - 问题: 9万+条重复记录

4. **订单平衡校验脚本**
   - 文件: `docs/查询sql/订单收入平衡校验.sql`
   - 用途: 检验收入摊销主表的跨月平衡

5. **跨月验证发现差异**
   - 2024-01差异: 375,162.54元
   - 原因: 36,181个订单在2023-12月有余额，但2024-01月没有记录
   - SQL文件: `docs/查询sql/2023年12月有余额2024年1月无记录订单.sql`

6. **僵尸订单问题发现** ⚠️
   - **问题**: 大量"僵尸订单"导致每月月末余额差异，无法通过月度订单平衡检查
   - **统计数据**:
     - 2022年之前有余额的僵尸订单: 6,102个
     - 2023年之前有余额的僵尸订单: 38,372个
     - 2024年之前有余额的僵尸订单: 248,211个
   - **检查脚本**: 详见 `workspace/rundeedu_scripts.md`

7. **后续行动** ✅
   - **时间**: 2026年2月1日
   - **行动**: 在润德教育研发群通知团队
   - **要求**: 检查僵尸订单产生原因，补上缺失的月份数据

---

## 2026年2月1日 - 新发现问题

### 财务数据与清洗库金额不一致 ⚠️
- **问题描述**: 润德教育的财务收入和退款数据与清洗库中的订单记录金额存在不一致
- **影响**: 部分订单的财务显示金额与清洗库中的实际金额不匹配
- **状态**: 尚未找到有效的核对方法
- **需要**: 进一步分析数据差异来源，设计针对性的核对方案
- **核对脚本**: 详见 `workspace/rundeedu_scripts.md`
