# 工作记录 - 2026年2月25日

## 📋 任务概述

**任务名称**：2024年9月-10月六场景订单数据提取  
**涉及场景**：转班、退费、休学、延考、重读、寄签（共6种售后场景）  
**时间范围**：2024年9月1日 - 2024年10月31日

---

## 🔄 方案演变过程

### 方案一：修改原有脚本 + PC端界面（失败）

**思路**：
- 基于现有的 Python 数据提取脚本进行改造
- 增加 PC 端图形化操作界面，方便后续复用
- 在脚本中添加时间筛选条件（2024年9月-10月）

**遇到的问题**：
- 添加时间筛选后，查询结果出现**大量重复数据**
- 调试排查耗时较长，问题难以快速定位
- 在原有逻辑上修补，代码越来越复杂

**耗时**：约大半天时间

---

### 方案二：分阶段提取（成功）✅

**思路转变**：
> 不要在一个方法上死磕，换个思路解决问题

**实施步骤**：

1. **第一步：提取订单号**
   - 从售后表(`after_sale`)中查询
   - 筛选条件：6种售后类型 + 指定日期范围
   - 输出：6个文本文件（每场景一个文件）
   - 格式：每行一个订单号

2. **第二步：订单链提取**
   - 使用现有脚本：`batch_order_chain_query.py` 或 `extract_full_order_chain.py`
   - 输入：第一步生成的订单号列表文件
   - 输出：完整的订单链数据

**优势**：
- 利用现有稳定脚本，避免重复造轮子
- 分阶段处理，逻辑清晰
- 查询速度快，结果准确

---

## 🎯 核心经验教训

### 1. 及时止损，切换思路
- ❌ 不要在行不通的方案上消耗过多时间
- ✅ 当遇到难以解决的技术问题时，考虑换个实现路径
- ✅ 实现目标的方法不止一种，选择最高效的路径

### 2. 善用现有工具
- 项目中已存在`订单链提取脚本`，专门为提取指定订单号的完整链而设计
- 与其改造通用脚本，不如组合使用专用工具

### 3. 分而治之
- 将复杂任务拆解为多个简单步骤
- 先缩小范围（提取订单号），再深度查询（订单链）
- 每步独立验证，降低出错风险

---

## 📁 相关脚本位置

| 脚本 | 用途 | 路径 |
|------|------|------|
| `batch_order_chain_query.py` | 批量订单链查询 | `/Volumes/SanDisk2T/dv-codeBase/RunDeEdu/` |
| `extract_full_order_chain.py` | 提取完整订单链 | `/Volumes/SanDisk2T/dv-codeBase/RunDeEdu/` |
| 售后数据查询SQL | 提取6场景订单号 | 需单独编写 |

---

## 💡 后续建议

1. **标准化流程**：将本次成功的"分阶段提取"方法文档化，形成标准操作流程
2. **脚本优化**：考虑将两步合并为一个自动化脚本，减少人工操作
3. **经验传承**：团队成员遇到类似问题时，参考本次经验，避免重复踩坑

---

## 📝 关键SQL参考

```sql
-- 第一步：从售后表提取6场景的订单号
SELECT DISTINCT order_code, after_sale_type
FROM after_sale
WHERE after_sale_type IN ('转班', '退费', '休学', '延考', '重读', '寄签')
  AND DATE_FORMAT(finish_time, '%Y-%m') BETWEEN '2024-09' AND '2024-10'
  AND deleted = 0
ORDER BY after_sale_type, order_code;
```

---

*记录时间：2026-02-25*  
*记录人：小d*  
*关键词：数据提取、订单链、售后场景、思路转换、及时止损*
