# 茂名文旅项目 - 迭代开发需求记录

## 记录日期
2026-02-14

---

## 新功能需求：拼车预约时间限制

### 需求描述
拼车功能需要设置时间限制，用户只能提前预约，不能预约即时或太近的时间。

### 具体规则
- **提前时间**: 24小时（可配置）
- **示例**: 
  - 当前时间: 2月14日 23:00
  - 可预约最早时间: 2月15日 23:00之后
  - 不能预约: 2月14日 23:00 ~ 2月15日 23:00 之间的时间

### 业务场景
- 给司机/运营商留出准备时间
- 避免临时订单导致无法安排车辆
- 提升服务质量和可预期性

### 涉及端
- [ ] 移动端H5 - 发起拼车页面
- [ ] 后端API - 时间校验逻辑
- [ ] PC管理端 - 时间配置（可能）

### 技术实现思路

#### 1. 后端校验
```javascript
// 预约时间校验
const MIN_ADVANCE_HOURS = 24;

const isValidBookingTime = (bookingTime) => {
  const now = dayjs();
  const booking = dayjs(bookingTime);
  const minBookingTime = now.add(MIN_ADVANCE_HOURS, 'hour');
  
  return booking.isAfter(minBookingTime);
};
```

#### 2. 前端限制
- 日期选择器：禁用24小时内的日期选项
- 时间选择器：根据选择的日期动态限制可选时间
- 提交前校验：给出友好提示

#### 3. 配置化（可选）
- 是否支持后台配置提前时间（如12小时、24小时、48小时）
- 不同路线是否有不同限制

### 待确定问题
1. 提前时间是否可配置？（固定24小时还是灵活配置）
2. 是否所有路线统一规则？
3. 特殊场景处理：（如节假日、紧急情况）
4. 提示文案：如何友好地提示用户"需要提前24小时预约"

### 优先级
待定

### 计划排期
待定

---

## 相关文档
- 拼车功能原方案: `docs/拼车信息智能识别功能方案.md`
- 支付功能改造: `docs/支付功能改造方案.md`
